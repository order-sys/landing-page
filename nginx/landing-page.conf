#!/usr/bin/env bash
set -e

DOMAIN="syrianorder.com"
SITE_DIR="/var/www/landing-page"

echo "ðŸ”¹ Installing nginx if missing..."
sudo apt update
sudo apt install -y nginx

echo "ðŸ”¹ Deploying website files..."
sudo mkdir -p $SITE_DIR
sudo rsync -av --delete ./ $SITE_DIR \
  --exclude nginx \
  --exclude .git \
  --exclude deploy.sh

sudo chown -R www-data:www-data $SITE_DIR
sudo chmod -R 755 $SITE_DIR

echo "ðŸ”¹ Installing nginx config..."
sudo cp nginx/landing-page.conf /etc/nginx/sites-available/$DOMAIN
sudo ln -sf /etc/nginx/sites-available/$DOMAIN /etc/nginx/sites-enabled/$DOMAIN

echo "ðŸ”¹ Testing nginx config..."
sudo nginx -t

echo "ðŸ”¹ Reloading nginx..."
sudo systemctl reload nginx

echo "âœ… Deployment complete"
